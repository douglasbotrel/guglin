<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>dBGiX</title>

	<link rel="stylesheet" href="styless.css">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="source/jquery-ui.min.css">
	<link rel="stylesheet" href="plugins/sidebar/L.Control.Sidebar.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
	<link rel="stylesheet" href="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.css">
	<link rel="stylesheet" href="plugins/mouseposition/L.Control.MousePosition.css">
	<link rel="stylesheet" href="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css">
	<link rel="stylesheet" href="plugins/minimap/Control.MiniMap.min.css">
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
	<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css"/>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet-src.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js"></script>
	<script src="source/jquery-ui.min.js"></script>
	<script src="plugins/sidebar/L.Control.Sidebar.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
	<script src="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.js"></script>
	<script src="plugins/mouseposition/L.Control.MousePosition.js"></script>
	<script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.js"></script>
	<script src="plugins/minimap/Control.MiniMap.min.js">"></script>
	<script src="plugins/ajax/leaflet.ajax.js"></script>
	<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.min.js"></script>


    <style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
  }
  #consentPopup {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  #consentContent {
    background: #fff;
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
    padding: 20px 25px;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
  }
  #consentContent h2 {
    margin-top: 0;
    font-size: 22px;
    margin-bottom: 10px;
  }
  #consentContent p {
    font-size: 14px;
    line-height: 1.5;
    margin-bottom: 12px;
  }
  #consentContent ul {
    margin-left: 20px;
    margin-bottom: 12px;
  }
  #consentContent li {
    margin-bottom: 6px;
    font-size: 14px;
  }
  #consentFooter {
    margin-top: 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 10px;
  }
  #consentFooter label {
    font-size: 14px;
  }
  #acceptBtn {
    padding: 10px 18px;
    font-size: 15px;
    border: none;
    background-color: #007bff;
    color: white;
    border-radius: 4px;
    cursor: not-allowed;
    opacity: 0.5;
    transition: background-color 0.3s ease;
  }
  #acceptBtn.enabled {
    cursor: pointer;
    opacity: 1;
  }
</style>


	 <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    #mapweb { width: 100%; height: 100vh; }

    .search-container {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.2);
    }

    .search-container input {
      padding: 6px 12px;
      border-radius: 20px;
      border: 1px solid #ccc;
      font-size: 14px;
      width: auto;
      min-width: 180px;
    }

    .search-buttons {
      display: flex;
      gap: 5px;
    }

    .search-container button {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #searchBtn { background-color: #4CAF50; }
    #clearBtn  { background-color: #f44336; }
    #btnResetMap { background-color: #2196F3; }

    #resultadoBusca {
      position: absolute;
      top: 100px;
      left: 10px;
      z-index: 1000;
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.2);
      padding: 10px;
      font-size: 14px;
      display: none;
      max-height: 50vh;
      overflow-y: auto;
      width: 300px;
    }

    .popup-content img {
      max-width: 100%;
      border-radius: 6px;
      margin-top: 8px;
      box-shadow: 0 0 4px rgba(0,0,0,0.2);
    }

    /* Botão WhatsApp */
    .whatsapp-btn {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 9999;
      background-color: #25D366;
      color: white;
      padding: 12px;
      border-radius: 50%;
      text-decoration: none;
      font-size: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>

  <div id="consentPopup">
  <div id="consentContent">
    <h2>Termo de Uso, Aviso Legal e Política de Privacidade</h2>

    <p><strong>1. Objetivo do Aplicativo</strong><br />
    Este aplicativo tem como objetivo oferecer informações turísticas, históricas, culturais e comerciais da cidade, auxiliando turistas e visitantes no planejamento e aproveitamento da estadia.</p>

    <p><strong>2. Conteúdo Histórico e Cultural</strong><br />
    As informações históricas e culturais apresentadas são de caráter exclusivamente informativo e educativo, baseadas em pesquisas realizadas em fontes públicas e confiáveis. Eventuais imprecisões podem ocorrer e estão sujeitas a correção mediante contato do usuário.</p>

    <p><strong>3. Fotografias e Conteúdo Visual</strong><br />
    As imagens usadas são de autoria da equipe do aplicativo ou provenientes de fontes autorizadas para uso gratuito. É proibida a reprodução, distribuição ou uso comercial não autorizado das imagens e conteúdos visuais aqui presentes.</p>

    <p><strong>4. Publicidade e Conteúdo Comercial</strong><br />
    O aplicativo inclui informações e anúncios de estabelecimentos comerciais locais, com fins meramente promocionais e informativos. A presença desses anúncios não implica qualquer vínculo ou recomendação oficial das instituições culturais, governamentais ou turísticas citadas.</p>

    <p><strong>5. Limitação de Responsabilidade</strong><br />
    Não garantimos a precisão ou atualização constante de horários, preços ou serviços dos estabelecimentos comerciais e pontos turísticos indicados. Recomenda-se contato direto para confirmação.</p>

    <p><strong>6. Propriedade Intelectual</strong><br />
    Todo conteúdo original, incluindo textos, imagens, mapas e design, está protegido por direitos autorais. A reprodução parcial ou total sem autorização é proibida.</p>

    <p><strong>7. Proteção de Dados Pessoais (LGPD)</strong><br />
    Ao utilizar este aplicativo, o usuário concorda com a coleta e uso de seus dados pessoais para fins de melhoria do serviço e comunicação, conforme previsto na Lei Geral de Proteção de Dados (Lei nº 13.709/2018).<br />
    Os dados coletados serão armazenados com segurança e não serão compartilhados com terceiros sem consentimento prévio, exceto quando exigido por lei.</p>

    <p><strong>Dados coletados podem incluir:</strong></p>
    <ul>
      <li>Informações de cadastro (nome, e-mail, telefone);</li>
      <li>Dados de navegação no aplicativo;</li>
      <li>Informações fornecidas voluntariamente pelo usuário.</li>
    </ul>

    <p><strong>Direitos do usuário:</strong></p>
    <ul>
      <li>Acessar, corrigir ou solicitar exclusão de seus dados;</li>
      <li>Revogar consentimento para tratamento dos dados;</li>
      <li>Solicitar informações sobre o uso dos dados.</li>
    </ul>

    <p>Para exercer esses direitos, entre em contato pelo e-mail: <a href="mailto:douglasbotrel@yahoo.com.br">douglasbotrel@yahoo.com.br</a>.</p>

    <p><strong>8. Atualizações e Contato</strong><br />
    Este Termo pode ser atualizado periodicamente. Recomendamos que o usuário o consulte sempre que utilizar o aplicativo.<br />
    Dúvidas, sugestões ou solicitações podem ser enviadas para: <a href="mailto:douglasbotrel@yahoo.com.br">douglasbotrel@yahoo.com.br</a>.</p>

    <div id="consentFooter">
      <label><input type="checkbox" id="acceptCheckbox" /> Li e aceito os termos de uso e a política de privacidade.</label>
      <button id="acceptBtn" disabled>Aceito</button>
    </div>
  </div>
</div>


<div class="search-container">
  <input id="searchBox" placeholder="Buscar...">
  <div class="search-buttons">
    <button id="searchBtn" title="Buscar"><i class="fas fa-search"></i></button>
    <button id="clearBtn" title="Limpar"><i class="fas fa-times"></i></button>
    <button id="btnResetMap" title="Centralizar"><i class="fas fa-crosshairs"></i></button>
  </div>
</div>

<div id="resultadoBusca">
  <strong>Resultados da busca:</strong>
  <ul id="listaResultados" style="padding-left: 18px; margin-top: 8px;"></ul>
</div>

<div id="mapweb"></div>

<!-- Ícone WhatsApp -->
<a href="https://wa.me/5563984406893" target="_blank" class="whatsapp-btn" title="Contato via WhatsApp">
  <i class="fab fa-whatsapp"></i>
</a>

<script>
const mymap = L.map('mapweb', {
  center: [-18.245, -43.598],
  zoom: 16,
  maxZoom: 18,
  minZoom: 14,
  attributionControl: false
});

L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
  maxZoom: 23
}).addTo(mymap);

L.control.mousePosition({ position: 'bottomright' }).addTo(mymap);
L.control.scale({ position: 'bottomleft' }).addTo(mymap);

const camadas = [
  { nome: "tombado",     cor: "#000",  dash: "4 6" },
  { nome: "basemapa",    cor: "#F5F5DC", preenchimento: true },
  { nome: "rotas",       cor: "#FFE4B5", peso: 4 },
  { nome: "ucestadual",  cor: "#90EE90", preenchimento: true }
];

camadas.forEach(({ nome, cor, dash = '', peso = 2, preenchimento = false }) => {
  L.geoJSON.ajax(`data/${nome}.geojson`, {
    style: () => ({
      color: cor,
      weight: peso,
      dashArray: dash,
      fillColor: preenchimento ? cor : 'transparent',
      fillOpacity: preenchimento ? 0.3 : 0
    })
  }).addTo(mymap);
});

let locaisLayer;
const highlightStyle = {
  color: "#3399FF",
  fillColor: "#3399FF",
  fillOpacity: 0.5,
  weight: 2
};
const defaultStyle = {
  color: "#FF0000",
  fillColor: "#FF0000",
  fillOpacity: 0.3,
  weight: 1
};



function buscarPalavraChave() {
  const keyword = document.getElementById("searchBox").value.trim().toLowerCase();
  const listaResultados = document.getElementById("listaResultados");
  const painel = document.getElementById("resultadoBusca");
  listaResultados.innerHTML = "";
  let encontrados = [];

  locaisLayer.eachLayer(layer => {
    const p = layer.feature.properties;
    const match = [p.Nome, p.Tipo, p.Detalhe].some(val =>
      val && val.toLowerCase().includes(keyword)
    );
    if (match) {
      layer.setStyle(highlightStyle);
      layer.bringToFront();
      encontrados.push(layer);
      const li = document.createElement("li");
      li.textContent = p.Nome;
      li.style.cursor = "pointer";
      li.onclick = () => {
        mymap.setView(layer.getBounds().getCenter(), 17);
        layer.openPopup();
      };
      listaResultados.appendChild(li);
    } else {
      layer.setStyle(defaultStyle);
    }
  });

  painel.style.display = encontrados.length ? "block" : "none";
  if (!encontrados.length) alert("Nenhum resultado encontrado.");
}

document.getElementById("searchBtn").onclick = buscarPalavraChave;
document.getElementById("searchBox").onkeydown = e => {
  if (e.key === "Enter") buscarPalavraChave();
};
document.getElementById("clearBtn").onclick = () => {
  document.getElementById("searchBox").value = "";
  document.getElementById("resultadoBusca").style.display = "none";
  locaisLayer.eachLayer(layer => layer.setStyle(defaultStyle));
};
document.getElementById("btnResetMap").onclick = () => {
  mymap.setView([-18.245, -43.598], 16);
};


locaisLayer = L.geoJSON.ajax('data/locais.geojson', {
  style: () => defaultStyle,
  onEachFeature: function (feature, layer) {
    const p = feature.properties;
    const nome = p.Nome || "Sem nome";
    const tipo = p.Tipo || "Tipo desconhecido";
    const detalhe = p.Detalhe || "Sem detalhes";
    const link = p.Link;
    const fotoBase = p.foto;
    const MAX_PHOTOS = p.fotoCount || 5;
    let popupContent = `<div class='popup-content'><strong>${nome}</strong><br><em>${tipo}</em><br><p>${detalhe}</p>`;
    if (link) popupContent += `<a href='${link}' target='_blank'>Mais informações</a><br>`;
    if (fotoBase) {
      const exts = ['jpg','png'];
      for (let i = 1; i <= MAX_PHOTOS; i++) {
        const suffix = i === 1 ? '' : i;
        exts.forEach(ext => {
          popupContent += `<img src='img/${fotoBase}${suffix}.${ext}' alt='${nome} ${suffix}' onerror="this.style.display='none'">`;
        });
      }
    }
    popupContent += `</div>`;
    layer.bindPopup(popupContent);
  }
}).addTo(mymap);

//termo de aceite de uso do app

const popup = document.getElementById('consentPopup');
  const checkbox = document.getElementById('acceptCheckbox');
  const btn = document.getElementById('acceptBtn');

  // Função para pegar IP via API pública
  async function getUserIP() {
    try {
      const response = await fetch('https://api.ipify.org?format=json');
      const data = await response.json();
      return data.ip;
    } catch (e) {
      console.warn('Não foi possível obter IP:', e);
      return null;
    }
  }

  // Função para verificar se o termo foi aceito nos últimos 24h para o IP
  async function checkConsent() {
    const ip = await getUserIP();
    if (!ip) {
      // Se não conseguir IP, usa localStorage simples por dispositivo
      const consentTime = localStorage.getItem('consentTime');
      if(consentTime) {
        const diff = Date.now() - parseInt(consentTime,10);
        if(diff < 24 * 60 * 60 * 1000) {
          return true; // Já aceitou em menos de 24h
        }
      }
      return false;
    }

    // Se tem IP, buscar no localStorage o consentimento para esse IP
    const consentDataJSON = localStorage.getItem('consentData');
    if(!consentDataJSON) return false;

    try {
      const consentData = JSON.parse(consentDataJSON);
      if(consentData.ip === ip) {
        const diff = Date.now() - consentData.timestamp;
        if(diff < 24 * 60 * 60 * 1000) {
          return true; // Aceitou em menos de 24h
        }
      }
    } catch(e) {
      return false;
    }

    return false;
  }

  // Mostrar popup se necessário
  async function initConsent() {
    const consentGiven = await checkConsent();
    if(consentGiven) {
      // Não mostrar popup e liberar app
      liberarScroll();
      popup.style.display = 'none';
    } else {
      // Mostrar popup e bloquear fundo
      popup.style.display = 'flex';
      bloquearScroll();
    }
  }

  // Controle do botão aceitar
  checkbox.addEventListener('change', () => {
    if(checkbox.checked) {
      btn.disabled = false;
      btn.classList.add('enabled');
    } else {
      btn.disabled = true;
      btn.classList.remove('enabled');
    }
  });

  btn.addEventListener('click', async () => {
    if(checkbox.checked) {
      const ip = await getUserIP();
      const consentData = {
        timestamp: Date.now(),
        ip: ip || null
      };
      localStorage.setItem('consentData', JSON.stringify(consentData));
      liberarScroll();
      popup.style.display = 'none';
      // Aqui o app pode rodar normalmente
    }
  });

  // Bloquear scroll do fundo
  function bloquearScroll() {
    document.body.style.overflow = 'hidden';
  }
  function liberarScroll() {
    document.body.style.overflow = '';
  }

  // Inicializa consentimento ao carregar
  window.onload = initConsent;
</script>

</body>

</html>




legenda.onAdd = function (map) {
  const div = L.DomUtil.create('div', 'info legend');
  div.innerHTML = `
    <strong>Legenda</strong><br>
    <i style="background:#000;width:12px;height:12px;display:inline-block;margin-right:6px;"></i> Tombado<br>
    <i style="background:#F5F5DC;width:12px;height:12px;display:inline-block;margin-right:6px;"></i> Base<br>
    <i style="background:#FFE4B5;width:12px;height:12px;display:inline-block;margin-right:6px;"></i> Rotas<br>
    <i style="background:#90EE90;width:12px;height:12px;display:inline-block;margin-right:6px;"></i> UC Estadual
  `;
  return div;
};

legenda.addTo(mymap);
