<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>dBGiX</title>

	<link rel="stylesheet" href="styless.css">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="source/jquery-ui.min.css">
	<link rel="stylesheet" href="plugins/sidebar/L.Control.Sidebar.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
	<link rel="stylesheet" href="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.css">
	<link rel="stylesheet" href="plugins/mouseposition/L.Control.MousePosition.css">
	<link rel="stylesheet" href="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css">
	<link rel="stylesheet" href="plugins/minimap/Control.MiniMap.min.css">
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
	<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css"/>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet-src.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js"></script>
	<script src="source/jquery-ui.min.js"></script>
	<script src="plugins/sidebar/L.Control.Sidebar.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
	<script src="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.js"></script>
	<script src="plugins/mouseposition/L.Control.MousePosition.js"></script>
	<script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.js"></script>
	<script src="plugins/minimap/Control.MiniMap.min.js">"></script>
	<script src="plugins/ajax/leaflet.ajax.js"></script>
	<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.min.js"></script>


	 <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    #mapweb { width: 100%; height: 100vh; }
    .search-container {
      position: absolute;
      top: 10px; left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      background: white;
      padding: 8px;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.2);
    }
    .search-container input {
      padding: 8px;
      border-radius: 20px;
      border: 1px solid #ccc;
      font-size: 14px;
      flex: 1 1 200px;
    }
    .search-container button {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    #searchBtn { background-color: #4CAF50; }
    #clearBtn  { background-color: #f44336; }
    #btnResetMap { background-color: #2196F3; }
    #resultadoBusca {
      position: absolute;
      top: 60px; left: 10px;
      z-index: 1000;
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.2);
      padding: 10px;
      font-size: 14px;
      display: none;
      max-height: 50vh;
      overflow-y: auto;
      width: 300px;
    }
    .popup-content img {
      max-width: 100%;
      border-radius: 6px;
      margin-top: 8px;
      box-shadow: 0 0 4px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>

<div class="search-container">
    <input id="searchBox" placeholder="Buscar...">
    <button id="searchBtn" title="Buscar"><i class="fas fa-search"></i></button>
    <button id="clearBtn" title="Limpar"><i class="fas fa-times"></i></button>
    <button id="btnResetMap" title="Centralizar"><i class="fas fa-crosshairs"></i></button>
  </div>

  <div id="resultadoBusca">
    <strong>Resultados da busca:</strong>
    <ul id="listaResultados" style="padding-left: 18px; margin-top: 8px;"></ul>
  </div>


<div id="mapweb"></div>

<a href="https://wa.me/5563984406893" target="_blank"
   style="position: fixed; bottom: 20px; left: 20px; z-index: 9999;
          background-color: #25D366; color: white; padding: 12px 20px;
          border-radius: 30px; text-decoration: none; font-weight: bold;
          font-size: 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.3);">
  Contato
</a>

<script>
const mymap = L.map('mapweb', {
  center: [-18.245, -43.598],
  zoom: 16,
  maxZoom: 18,
  minZoom: 14,
  attributionControl: false
});

// Satélite ESRI como base
L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
  maxZoom: 23
}).addTo(mymap);

// Controles adicionais
L.control.mousePosition({ position: 'bottomright' }).addTo(mymap);
L.control.scale({ position: 'bottomleft' }).addTo(mymap);

// Layers GeoJSON
const camadas = [
  { nome: "tombado",     cor: "#000",  dash: "4 6" },
  { nome: "basemapa",    cor: "#F5F5DC", preenchimento: true },
  { nome: "rotas",       cor: "#FFE4B5", peso: 4 },
  { nome: "ucestadual",  cor: "#90EE90", preenchimento: true }
];

camadas.forEach(({ nome, cor, dash = '', peso = 2, preenchimento = false }) => {
  L.geoJSON.ajax(`data/${nome}.geojson`, {
    style: () => ({
      color: cor,
      weight: peso,
      dashArray: dash,
      fillColor: preenchimento ? cor : 'transparent',
      fillOpacity: preenchimento ? 0.3 : 0
    })
  }).addTo(mymap);
});

// Locais com popup e imagens
let locaisLayer;
const highlightStyle = {
  color: "#3399FF",
  fillColor: "#3399FF",
  fillOpacity: 0.5,
  weight: 2
};
const defaultStyle = {
  color: "#FF0000",
  fillColor: "#FF0000",
  fillOpacity: 0.3,
  weight: 1
};

locaisLayer = L.geoJSON.ajax('data/locais.geojson', {
  style: () => defaultStyle,
  onEachFeature: function (feature, layer) {
    const p = feature.properties;
    const nome = p.Nome || "Sem nome";
    const tipo = p.Tipo || "Tipo desconhecido";
    const detalhe = p.Detalhe || "Sem detalhes";
    const link = p.Link;
    const fotoBase = p.foto;
    const MAX_PHOTOS = p.fotoCount || 5;
    let popupContent = `<div class='popup-content'><strong>${nome}</strong><br><em>${tipo}</em><br><p>${detalhe}</p>`;
    if (link) popupContent += `<a href='${link}' target='_blank'>Mais informações</a><br>`;

    if (fotoBase) {
      const exts = ['jpg','png'];
      for (let i = 1; i <= MAX_PHOTOS; i++) {
        const suffix = i === 1 ? '' : i;
        exts.forEach(ext => {
          popupContent += `<img src='img/${fotoBase}${suffix}.${ext}' alt='${nome} ${suffix}' onerror="this.style.display='none'">`;
        });
      }
    }
    popupContent += `</div>`;
    layer.bindPopup(popupContent);
  }
}).addTo(mymap);

// BUSCA
function buscarPalavraChave() {
  const keyword = document.getElementById("searchBox").value.trim().toLowerCase();
  const listaResultados = document.getElementById("listaResultados");
  const painel = document.getElementById("resultadoBusca");
  listaResultados.innerHTML = "";
  let encontrados = [];

  locaisLayer.eachLayer(layer => {
    const p = layer.feature.properties;
    const match = [p.Nome, p.Tipo, p.Detalhe].some(val =>
      val && val.toLowerCase().includes(keyword)
    );
    if (match) {
      layer.setStyle(highlightStyle);
      layer.bringToFront();
      encontrados.push(layer);
      const li = document.createElement("li");
      li.textContent = p.Nome;
      li.style.cursor = "pointer";
      li.onclick = () => {
        mymap.setView(layer.getBounds().getCenter(), 17);
        layer.openPopup();
      };
      listaResultados.appendChild(li);
    } else {
      layer.setStyle(defaultStyle);
    }
  });

  painel.style.display = encontrados.length ? "block" : "none";
  if (!encontrados.length) alert("Nenhum resultado encontrado.");
}

document.getElementById("searchBtn").onclick = buscarPalavraChave;
document.getElementById("searchBox").onkeydown = e => {
  if (e.key === "Enter") buscarPalavraChave();
};
document.getElementById("clearBtn").onclick = () => {
  document.getElementById("searchBox").value = "";
  document.getElementById("resultadoBusca").style.display = "none";
  locaisLayer.eachLayer(layer => layer.setStyle(defaultStyle));
};
document.getElementById("btnResetMap").onclick = () => {
  mymap.setView([-18.245, -43.598], 16);
};
</script>

</body>

</html>


